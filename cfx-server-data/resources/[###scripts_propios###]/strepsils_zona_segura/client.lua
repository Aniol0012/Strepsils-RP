--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
--
--			  ███████	████████████	████████	███████		████████	███████		████████████	██				███████			  ██████████	████████
--			  ██			 ██			██	  ██	██			██	  ██	██			     ██    		██				██ 				  ██	  ██	██	  ██
--			  ██			 ██			██	  ██	██			██    ██	██			     ██			██				██				  ██	  ██	██	  ██
--			  ███████	 	 ██			████████	███████		████████	███████	         ██ 		██				███████			  ██████████	████████
--				   ██		 ██			██  ██		██			██				 ██	         ██			██					 ██			  ██  ██		██
--				   ██ 		 ██			██  ██		██			██				 ██	         ██ 		██ 				     ██   		  ██  ██		██
--			  ███████		 ██			██	████	███████		██			███████		████████████	███████████		███████			  ██  ██████	██
--																																																				          By Aniol0012
--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

-- ¡¡¡NO TOCAR NADA SI NO SABES LO QUE HACES!!1

-- ¡¡¡AVISAO Estás!!!

--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
-- Locales
--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

local closestZone = 1

local textoVisible = true

--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
-- Draw text y marcadores
--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

ToggleTexto = function()
	textoVisible = not textoVisible
end

--[[ Solo era para testear

RegisterCommand("zona", function()
    ToggleTexto()
end)

]]

RegisterNetEvent('strepsils_zona')
AddEventHandler('strepsils_zona', function()
	ToggleTexto()
end)

RegisterNetEvent('strepsils_cerrar_zona')
AddEventHandler('strepsils_cerrar_zona', function()
	if textoVisible then
		textoVisible = false
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(0)
		local coords = GetEntityCoords(GetPlayerPed(-1))
		for i,v in pairs(Config.zonasegura) do
			if textoVisible and Config.Mostrar_texto_zonasegura and GetDistanceBetweenCoords(coords, v.x, v.y, v.z, true) < Config.Distancia then
				drawTxt("Estás en ~g~zona segura",4, 1, 0.222, 0.935, 0.67,255,255,255,255)
			end
		end
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(0)
		local coords = GetEntityCoords(GetPlayerPed(-1))
		for i,v in pairs(Config.evento) do
			if textoVisible and Config.Mostrar_texto_evento and GetDistanceBetweenCoords(coords, v.x, v.y, v.z, true) < Config.DistanciaEvento then
				drawTxt("Estás en un ~y~evento",4, 1, 0.216, 0.935, 0.67,255,255,255,255)
			end
		end
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(0)
		local coords = GetEntityCoords(GetPlayerPed(-1))
		for i,v in pairs(Config.zonamafia) do
			if textoVisible and Config.Mostrar_texto_zonamafia and GetDistanceBetweenCoords(coords, v.x, v.y, v.z, true) < Config.Distancia then
				drawTxt("Estás en ~r~zona de mafia",4, 1, 0.227, 0.935, 0.67,255,255,255,255)
			end
		end
	end
end)


function drawTxt(text,font,centre,x,y,scale,r,g,b,a)
    SetTextFont(font)
    SetTextProportional(0)
    SetTextScale(scale, scale)
    SetTextColour(r, g, b, a)
    SetTextDropShadow(0, 0, 0, 0,255)
    SetTextEdge(1, 0, 0, 0, 255)
    SetTextDropShadow()
    SetTextOutline()
    SetTextCentre(centre)
    SetTextEntry("STRING")
    AddTextComponentString(text)
    DrawText(x , y)
end

--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
-- Zona segura
--▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

Citizen.CreateThread(function()
	while not NetworkIsPlayerActive(PlayerId()) do
		Citizen.Wait(0)
	end
	
	while true do
		local playerPed = GetPlayerPed(-1)
		local x, y, z = table.unpack(GetEntityCoords(playerPed, true))
		local minDistance = 100000
		for i = 1, #Config.zones, 1 do
			dist = Vdist(Config.zones[i].x, Config.zones[i].y, Config.zones[i].z, x, y, z)
			if dist < minDistance then
				minDistance = dist
				closestZone = i
			end
		end
		Citizen.Wait(15000)
	end
end)

Citizen.CreateThread(function()
	while not NetworkIsPlayerActive(PlayerId()) do
		Citizen.Wait(0)
	end
	
	while true do
		Citizen.Wait(0)
		local player = GetPlayerPed(-1)
		local x,y,z = table.unpack(GetEntityCoords(player, true))
		local dist = Vdist(Config.zones[closestZone].x, Config.zones[closestZone].y, Config.zones[closestZone].z, x, y, z)
	
		if dist <= Config.Distancia then
			if not Config.Notificacion_entrar then
				NetworkSetFriendlyFireOption(false)
				ClearPlayerWantedLevel(PlayerId())
				SetCurrentPedWeapon(player,GetHashKey("WEAPON_UNARMED"),true)
				SetPlayerInvincible(GetPlayerIndex(),true)
				TriggerEvent("pNotify:SendNotification",{
					text = "Estás en<b style='color:#1EFF29'> zona segura</b>",
					type = "success",
					timeout = (3000),
					layout = Config.Alineacion,
					queue = "global"
				})
				Config.Notificacion_entrar = true
				Config.Notificacion_salir = false
			end
		else
			if not Config.Notificacion_salir then
				NetworkSetFriendlyFireOption(true)
				SetPlayerInvincible(GetPlayerIndex(),false)
				TriggerEvent("pNotify:SendNotification",{
					text = "Has salido de la<b style='color:#1EFF29'> zona segura</b>",
					type = "error",
					timeout = (3000),
					layout = Config.Alineacion,
					queue = "global"
				})
				Config.Notificacion_salir = true
				Config.Notificacion_entrar = false
			end
		end
		if Config.Notificacion_entrar then
		DisableControlAction(2, 37, true) -- Deshabilita el TAB
		DisablePlayerFiring(player,true) -- Deshabilita disparar si de alguna manera omiten la deshabilitación del mouse en la zona
      	DisableControlAction(0, 106, true) -- Desabilita el click izquierdo
		DisableControlAction(0, 140, true) -- Pegar con la r
			if IsDisabledControlJustPressed(2, 37) and not IsPauseMenuActive() then -- Al pulsar TAB se les enviará el mensaje de error.
				SetCurrentPedWeapon(player,GetHashKey("WEAPON_UNARMED"),true) -- if tab is pressed it will set them to unarmed (this is to cover the vehicle glitch until I sort that all out)
				TriggerEvent("pNotify:SendNotification",{
					text = "<b style='color:#FF1E1E'>No puedes usar armas en una Zona Segura</b>",
					type = "error",
					timeout = (3000),
					layout = Config.Alineacion,
					queue = "global"
				})
			end
			if IsDisabledControlJustPressed(0, 106) and not IsPedSittingInAnyVehicle(GetPlayerPed(-1)) and not IsPauseMenuActive() then -- Al hacer click izquierdo se les enviará el mensaje de error.
				SetCurrentPedWeapon(player,GetHashKey("WEAPON_UNARMED"),true) -- Al hacer click se les quitaran las armas.
				TriggerEvent("pNotify:SendNotification",{
					text = "<b style='color:#FF1E1E'>No puedes pegar en una Zona Segura.</b>",
					type = "error",
					timeout = (3000),
					layout = Config.Alineacion,
					queue = "global"
				})
			end
			if IsDisabledControlJustPressed(0, 140) and not IsPedSittingInAnyVehicle(GetPlayerPed(-1)) and not IsPauseMenuActive() then -- Pegar con la r
				SetCurrentPedWeapon(player,GetHashKey("WEAPON_UNARMED"),true) -- Al hacer click se les quitaran las armas.
				TriggerEvent("pNotify:SendNotification",{
					text = "<b style='color:#FF1E1E'>Esto tampoco puedes hacerlo pillín.</b>",
					type = "error",
					timeout = (3000),
					layout = Config.Alineacion,
					queue = "global"
				})
			end
		end
	 	if DoesEntityExist(player) then
	 		DrawMarker(1, Config.zones[closestZone].x, Config.zones[closestZone].y, Config.zones[closestZone].z-1.0001, 0, 0, 0, 0, 0, 0, 100.0, 100.0, 2.0, 13, 0, 255, 0, 0, 0, 2, 0, 0, 0, 0)

	 	end
	end
end)

-- No morir en zona:

--[[
Citizen.CreateThread(function()
	while not NetworkIsPlayerActive(PlayerId()) do
		Citizen.Wait(100)
	end
	
	while true do
		local playerPed = GetPlayerPed(-1)
		local x, y, z = table.unpack(GetEntityCoords(playerPed, true))
		local minDistance = 100000
		for i = 1, #Config.zonesinvencible, 1 do
			dist = Vdist(Config.zonesinvencible[i].x, Config.zonesinvencible[i].y, Config.zonesinvencible[i].z, x, y, z)
			if dist < minDistance then
				minDistance = dist
				closestZone = i
			end
		end
		Citizen.Wait(100)
	end
end)


Citizen.CreateThread(function()
	while not NetworkIsPlayerActive(PlayerId()) do
	
		Citizen.Wait(100)
	end
	
	while true do
		Citizen.Wait(100)
		local player = GetPlayerPed(-1)
		local x,y,z = table.unpack(GetEntityCoords(player, true))
		local veh = GetVehiclePedIsUsing(ped)
		local dist = Vdist(Config.zonesinvencible[closestZone].x, Config.zonesinvencible[closestZone].y, Config.zonesinvencible[closestZone].z, x, y, z)
		     
	
		if dist <= 40.0 then  
			if not jailOut then	
				SetPlayerInvincible(GetPlayerIndex(),true)
				-- SetPlayerSprint (10, false) -- Esto hace que en las zonas seguras no puedas correr.
                TriggerEvent('esx_basicneeds:healPlayer')-- hitch frames warning
			end
		else
			if not jailIn then
				SetPlayerInvincible(GetPlayerIndex(),false)
				-- SetPlayerSprint (10000, true)
			end
	 	end
	end
end)
]]
